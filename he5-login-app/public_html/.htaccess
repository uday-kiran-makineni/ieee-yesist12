RewriteEngine On

# Handle Authorization Header
SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1

# If the requested filename exists, serve it
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# If the requested directory exists, serve it
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Block direct access to all PHP files except index.php
RewriteCond %{REQUEST_URI} !^/index\.php$
RewriteRule ^(.+)\.php$ - [F,L]

# Otherwise, redirect all requests to index.php
RewriteRule ^(.*)$ index.php [QSA,L]

# PHP Configuration
php_value upload_max_filesize 10M
php_value post_max_size 10M
php_value max_execution_time 300
php_value memory_limit 256M

# Enable error reporting for development (disable in production)
php_flag display_errors Off
php_flag log_errors On

# Optional: Remove trailing slashes
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)/$ /$1 [R=301,L]